{
   "$schema":"https://vega.github.io/schema/vega-lite/v5.json",
   "title":"FRV Response Times Above Standard",
   "data":{
      "url":"https://raw.githubusercontent.com/JackECameron/FIT3179/main/D2_resources/data/responseTimes/FRV_total_combined.csv"
   },
   "params":[
      {
         "name":"qSelect",
         "value":1,
         "bind":{
            "input":"select",
            "options":[
               1,
               2,
               3,
               4
            ],
            "labels":[
               "Q1",
               "Q2",
               "Q3",
               "Q4"
            ],
            "name":"Quarter Selection: "
         }
      }
   ],
   "hconcat":[
      {
         "width":500,
         "height":400,
         "projection":{
            "type":"equirectangular"
         },
         "layer":[
            {
               "data":{
                  "url":"https://raw.githubusercontent.com/JackECameron/FIT3179/main/Week10Homework/js/LOCALITY_POLYGON.json",
                  "format":{
                     "type":"topojson",
                     "feature":"LOCALITY_POLYGON"
                  }
               },
               "mark":{
                  "type":"geoshape",
                  "fill":"#faf6f6",
                  "stroke":"black",
                  "strokeWidth":0.25,
                  "opacity":0.5
               }
            },
            {
               "params":[
                  {
                     "name":"loc_select",
                     "select":{
                        "type":"point",
                        "encodings":[
                           "description"
                        ]
                     }
                  }
               ],
               "transform":[
                  {
                     "lookup":"dis",
                     "from":{
                        "data":{
                           "url":"https://raw.githubusercontent.com/JackECameron/FIT3179/main/Week10Homework/js/finalSimplified.json",
                           "format":{
                              "type":"topojson",
                              "feature":"FRV_DISTRICT"
                           }
                        },
                        "key":"properties.DISTRICT"
                     },
                     "as":"geo"
                  },
                  {
                     "filter":"datum.q == qSelect"
                  },
                  {
                     "filter":"datum.sTag == 'agr'"
                  }
               ],
               "mark":{
                  "type":"geoshape",
                  "opacity":0.65,
                  "stroke":"black",
                  "strokeWidth":1.25
               },
               "encoding":{
                  "shape":{
                     "field":"geo",
                     "type":"geojson"
                  },
                  "description":{
                     "field":"dis"
                  },
                  "color":{
                     "field":"perMet",
                     "scale":{
                        "type":"linear",
                        "scheme":"goldred",
                        "domain":[
                           77,
                           93
                        ]
                     },
                     "legend":{
                        "title":"% Above Standard",
                        "titleColor":"#696969",
                        "orient":"none",
                        "legendX":151,
                        "legendY":360,
                        "direction":"horizontal",
                        "labelColor":"#696969"
                     }
                  },
                  "tooltip":[
                     {
                        "field":"dis",
                        "type":"nominal",
                        "title":"FRV District"
                     },
                     {
                        "field":"perMet",
                        "type":"quantitative",
                        "title":"% Responses Above 7.7 Min"
                     },
                     {
                        "field":"sNumber",
                        "type":"quantitative",
                        "title":"Number of Stations"
                     },
                     {
                        "field":"totInc",
                        "type":"quantitative",
                        "title":"Number of Incidences"
                     }
                  ]
               }
            }
         ]
      },
      {
         "width":500,
         "height":400,
         "layer":[
            {
               "transform":[
                  {
                     "filter":"datum.sTag != 'agr'"
                  },
                  {
                     "filter":{
                        "param":"loc_select"
                     }
                  },
                  {
                     "sort":[
                        {
                           "field":"perMet",
                           "order":"descending"
                        }
                     ],
                     "window":[
                        {
                           "op":"rank",
                           "as":"rank1"
                        }
                     ],
                     "groupby":[
                        "q"
                     ]
                  }
               ],
               "mark":{
                  "type":"line",
                  "orient":"vertical",
                  "opacity":0.75,
                  "strokeWidth":5
               },
               "encoding":{
                  "x":{
                     "field":"q",
                     "type":"ordinal",
                     "axis":{
                        "grid":true
                     }
                  },
                  "y":{
                     "field":"rank1",
                     "type":"ordinal",
                     "axis":{
                        "grid":true
                     }
                  },
                  "color":{
                     "field":"servArea",
                     "type":"nominal"
                  }
               }
            }
         ]
      }
   ]
}