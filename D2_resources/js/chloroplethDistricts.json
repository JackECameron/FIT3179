{
   "$schema":"https://vega.github.io/schema/vega-lite/v5.json",
   "title":{
      "text":"",
      "align":"center"
   },
   "data":{
      "url":"https://raw.githubusercontent.com/JackECameron/FIT3179/main/D2_resources/data/responseTimes/FRV_total_combined.csv"
   },
   "config":{
      "legend":{
         "disable":true
      },
      "view":{
         "stroke":"transparent"
      },
      "background": "#161a1d",
      "axis": {"gridColor": "#ffffff", "gridOpacity":0.4, "gridWidth": 3}
   },
   "params":[
      {
         "name":"qSelect",
         "value":1,
         "bind":{
            "input":"select",
            "options":[
               1,
               2,
               3,
               4
            ],
            "labels":[
               "Q1",
               "Q2",
               "Q3",
               "Q4"
            ],
            "name":"Quarter Selection: "
         }
      }
   ],
   "hconcat":[
      {
         "width":"container",
         "height":495,
         "projection":{
            "type":"equirectangular"
         },
         "layer":[
            {
               "title":{
                  "text":[
                     "Percentage Responses Above 7.7 Minute Standard"
                  ],
                  "font":"Calibri Light",
                  "color":"#ffffff",
                  "fontSize":24
               },
               "data":{
                  "url":"https://raw.githubusercontent.com/JackECameron/FIT3179/main/Week10Homework/js/LOCALITY_POLYGON.json",
                  "format":{
                     "type":"topojson",
                     "feature":"LOCALITY_POLYGON"
                  }
               },
               "mark":{
                  "type":"geoshape",
                  "fill":"#14213d",
                  "stroke":"#ffffff",
                  "strokeWidth":0.3,
                  "fillOpacity":0.2
               }
            },
            {
               "params":[
                  {
                     "name":"loc_select",
                     "value":"CENTRAL",
                     "select":{
                        "type":"point",
                        "encodings":[
                           "description"
                        ],
                        "on":"click",
                        "clear":false,
                        "toggle":false
                     }
                  }
               ],
               "transform":[
                  {
                     "lookup":"dis",
                     "from":{
                        "data":{
                           "url":"https://raw.githubusercontent.com/JackECameron/FIT3179/main/Week10Homework/js/finalSimplified.json",
                           "format":{
                              "type":"topojson",
                              "feature":"FRV_DISTRICT"
                           }
                        },
                        "key":"properties.DISTRICT"
                     },
                     "as":"geo"
                  },
                  {
                     "filter":"datum.q == qSelect"
                  },
                  {
                     "filter":"datum.sTag == 'agr'"
                  }
               ],
               "mark":{
                  "type":"geoshape",
                  "opacity":0.8,
                  "stroke":"#ffffff",
                  "strokeWidth":1.25
               },
               "encoding":{
                  "shape":{
                     "field":"geo",
                     "type":"geojson"
                  },
                  "description":{
                     "field":"dis"
                  },
                  "color":{
                     "field":"perMet",
                     "scale":{
                        "type":"linear",
                        "scheme":"goldred",
                        "domain":[
                           77,
                           93
                        ]
                     },
                     "legend":{
                        "title":"% Above Standard",
                        "titleColor":"#ffffff",
                        "orient":"none",
                        "legendX":0,
                        "legendY":430,
                        "direction":"horizontal",
                        "labelColor":"#ffffff"
                     }
                  },
                  "tooltip":[
                     {
                        "field":"dis",
                        "type":"nominal",
                        "title":"FRV District"
                     },
                     {
                        "field":"perMet",
                        "type":"quantitative",
                        "title":"% Responses Above 7.7 Min"
                     },
                     {
                        "field":"sNumber",
                        "type":"quantitative",
                        "title":"Number of Stations"
                     },
                     {
                        "field":"totInc",
                        "type":"quantitative",
                        "title":"Number of Incidences"
                     }
                  ]
               }
            }
         ]
      },
      {
         "width":"container",
         "height":495,
         "title":{
            "text":"Station Rankings",
            "font":"Calibri Light",
            "color":"#ffffff",
            "fontSize":24
         },
         "layer":[
            {
               "params":[
                  {
                     "name":"s_select",
                     "select":{
                        "type":"point",
                        "fields":[
                           "servArea"
                        ]
                     },
                     "bind":"legend"
                  }
               ],
               "transform":[
                  {
                     "filter":"datum.sTag != 'agr'"
                  },
                  {
                     "filter":{
                        "param":"loc_select"
                     }
                  },
                  {
                     "sort":[
                        {
                           "field":"perMet",
                           "order":"descending"
                        }
                     ],
                     "window":[
                        {
                           "op":"rank",
                           "as":"rank1"
                        }
                     ],
                     "groupby":[
                        "q"
                     ]
                  }
               ],
               "mark":{
                  "type":"line",
                  "orient":"vertical",
                  "opacity":0.6,
                  "strokeWidth":5
               },
               "encoding":{
                  "x":{
                     "field":"q",
                     "type":"ordinal",
                     "axis":{
                        "title":"Financial Quarter",
                        "titleFontSize":20,
                        "titleColor":"#ffffff",
                        "titleFont":"Calibri Light",
                        "domain":false,
                        "labelAngle":0,
                        "labelFontSize":18,
                        "labelFont":"Calibri Light",
                        "labelColor":"#ffffff",
                        "grid": true
                     }
                  },
                  "y":{
                     "field":"rank1",
                     "type":"ordinal",
                     "axis":{
                        "title":"",
                        "labels":false,
                        "ticks":false,
                        "domain":false
                     }
                  },
                  "color":{
                     "condition":{
                        "param":"s_select",
                        "value":"green",
                        "empty":false
                     },
                     "field":"servArea",
                     "type":"nominal",
                     "scale":{
                        "range": ["#e5e5e5"]
                     }
                  }
               }
            },
            {
               "transform":[
                  {
                     "filter":"datum.sTag != 'agr'"
                  },
                  {
                     "filter":{
                        "param":"loc_select"
                     }
                  },
                  {
                     "sort":[
                        {
                           "field":"perMet",
                           "order":"descending"
                        }
                     ],
                     "window":[
                        {
                           "op":"rank",
                           "as":"rank1"
                        }
                     ],
                     "groupby":[
                        "q"
                     ]
                  }
               ],
               "mark":{
                  "type":"circle",
                  "opacity":1,
                  "strokeWidth":5,
                  "stroke": "#ffffff",
                  "strokeOpacity": 0.6,
                  "filled":true,
                  "size":500
               },
               "encoding":{
                  "x":{
                     "field":"q",
                     "type":"ordinal",
                     "axis":{
                       
                     }
                  },
                  "y":{
                     "field":"rank1",
                     "type":"ordinal",
                     "axis":{
                        
                     }
                  },
                  "color":{
                     "condition":{
                        "param":"s_select",
                        "empty":false,
                        "value":"green"
                     },
                     "field":"servArea"
                  },
                  "tooltip":[
                     {
                        "field":"q",
                        "type":"nominal",
                        "title":"Quarter"
                     },
                     {
                        "field":"rank1",
                        "type":"quantitative",
                        "title":"Quarter Ranking"
                     },
                     {
                        "field":"90Avg",
                        "type":"quantitative",
                        "title":"90% Response Time (m)"
                     },
                     {
                        "field":"perMet",
                        "type":"quantitative",
                        "title":"% Above Standard"
                     }
                  ]
               }
            },
            {
               "transform":[
                  {
                     "filter":"datum.sTag != 'agr'"
                  },
                  {
                     "filter":{
                        "param":"loc_select"
                     }
                  },
                  {
                     "filter":"datum.q==4"
                  },
                  {
                     "sort":[
                        {
                           "field":"perMet",
                           "order":"descending"
                        }
                     ],
                     "window":[
                        {
                           "op":"rank",
                           "as":"rank1"
                        }
                     ],
                     "groupby":[
                        "q"
                     ]
                  }
               ],
               "mark":{
                  "type":"text",
                  "opacity":0.75,
                  "strokeWidth":5,
                  "filled":true,
                  "size":16,
                  "dx":50,
                  "align":"left",
                  "fontStyle":"italic"
               },
               "encoding":{
                  "x":{
                     "field":"q",
                     "type":"ordinal",
                     "axis":{
                        
                     }
                  },
                  "y":{
                     "field":"rank1",
                     "type":"ordinal",
                     "axis":{
                        
                     }
                  },
                  "color":{
                     "value":"#ffffff"
                  },
                  "text":{
                     "field":"servArea"
                  }
               }
            },
            {
               "mark":{
                  "type":"text",
                  "align":"left",
                  "baseline":"bottom",
                  "x":"width",
                  "y":0,
                  "font":"Calibri Light",
                  "color":"#ffffff",
                  "fontSize":20
               },
               "encoding":{
                  "text":{
                     "value":"Stations"
                  }
               }
            },
            {
               "mark":{
                  "type":"text",
                  "align":"center",
                  "baseline":"bottom",
                  "y":0,
                  "font":"Calibri Light",
                  "color":"#ffffff",
                  "fontSize":14
               },
               "encoding":{
                  "text":{
                     "value":{
                        "expr":"loc_select.dis"
                     }
                  }
               }
            },
            {
               "transform":[
                  {
                     "filter":"datum.sTag != 'agr'"
                  },
                  {
                     "filter":{
                        "param":"loc_select"
                     }
                  },
                  {
                     "filter":"datum.q==1"
                  },
                  {
                     "sort":[
                        {
                           "field":"perMet",
                           "order":"descending"
                        }
                     ],
                     "window":[
                        {
                           "op":"rank",
                           "as":"rank1"
                        }
                     ],
                     "groupby":[
                        "q"
                     ]
                  }
               ],
               "mark":{
                  "type":"text",
                  "opacity":0.75,
                  "strokeWidth":5,
                  "filled":true,
                  "size":16,
                  "dx":0,
                  "align":"center",
                  "fontStyle":"bold",
                  "font":"Calibri Light"
               },
               "encoding":{
                  "x":{
                     "field":"q",
                     "type":"ordinal",
                     "axis":{
                        
                     }
                  },
                  "y":{
                     "field":"rank1",
                     "type":"ordinal",
                     "axis":{
                        
                     }
                  },
                  "color":{
                     "value":"black"
                  },
                  "text":{
                     "field":"rank1"
                  }
               }
            },
            {
               "transform":[
                  {
                     "filter":"datum.sTag != 'agr'"
                  },
                  {
                     "filter":{
                        "param":"loc_select"
                     }
                  },
                  {
                     "filter":"datum.q==4"
                  },
                  {
                     "sort":[
                        {
                           "field":"perMet",
                           "order":"descending"
                        }
                     ],
                     "window":[
                        {
                           "op":"rank",
                           "as":"rank1"
                        }
                     ],
                     "groupby":[
                        "q"
                     ]
                  }
               ],
               "mark":{
                  "type":"text",
                  "opacity":0.75,
                  "strokeWidth":5,
                  "filled":true,
                  "size":16,
                  "dx":0,
                  "align":"center",
                  "fontStyle":"bold",
                  "font":"Calibri Light"
               },
               "encoding":{
                  "x":{
                     "field":"q",
                     "type":"ordinal",
                     "axis":{
                        
                     }
                  },
                  "y":{
                     "field":"rank1",
                     "type":"ordinal",
                     "axis":{
                        
                     }
                  },
                  "color":{
                     "value":"black"
                  },
                  "text":{
                     "field":"rank1"
                  }
               }
            }
         ]
      }
   ]
}